<UserControl x:Class="ZooManager.UI.Views.AnimalsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:conv="clr-namespace:ZooManager.UI.Converters"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="800"
             AutomationProperties.AutomationId="View.Animals">
    <UserControl.Resources>
        <conv:BoolToVisibilityConverter x:Key="BoolToVisibility"/>
    </UserControl.Resources>

    <Grid Margin="24">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="300"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Linke Seite: Tierliste -->
        <Border Grid.Column="0"
                Style="{StaticResource Card}"
                Margin="0,0,12,0"
                AutomationProperties.AutomationId="Animals.LeftCard">
            <DockPanel>
                <TextBlock Text="Tierbestand"
                           DockPanel.Dock="Top"
                           FontSize="20"
                           FontWeight="Bold"
                           Margin="0,0,0,16"
                           AutomationProperties.AutomationId="Animals.Title"/>

                <StackPanel DockPanel.Dock="Bottom" Margin="0,12,0,0">
                    <Button Content="+ Neues Tier"
                            Padding="8"
                            Command="{Binding AddAnimalCommand}"
                            Visibility="{Binding CanManageAnimals, Converter={StaticResource BoolToVisibility}}"
                            Background="{StaticResource PrimaryBrush}"
                            Foreground="White"
                            FontWeight="Bold"
                            AutomationProperties.AutomationId="Animals.AddAnimalBtn"/>
                    <Button Content="Tier löschen"
                            Padding="8"
                            Margin="0,8,0,0"
                            Command="{Binding DeleteAnimalCommand}"
                            Visibility="{Binding CanManageAnimals, Converter={StaticResource BoolToVisibility}}"
                            Background="#FFEBEE"
                            Foreground="#D32F2F"
                            BorderBrush="#FFCDD2"
                            AutomationProperties.AutomationId="Animals.DeleteAnimalBtn"/>
                </StackPanel>

                <ListBox BorderThickness="0"
                         ItemsSource="{Binding Animals}"
                         SelectedItem="{Binding SelectedAnimal}"
                         AutomationProperties.AutomationId="Animals.AnimalsList">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Margin="0,4">
                                <TextBlock Text="{Binding Name}"
                                           FontSize="16"
                                           FontWeight="SemiBold"
                                           AutomationProperties.AutomationId="Animals.ListItem.Name"/>
                                <TextBlock Text="{Binding SpeciesName}"
                                           FontSize="12"
                                           Foreground="{StaticResource TextMutedBrush}"
                                           AutomationProperties.AutomationId="Animals.ListItem.Species"/>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </DockPanel>
        </Border>

        <!-- Rechte Seite: Digitale Akte / Editor -->
        <Grid Grid.Column="1" AutomationProperties.AutomationId="Animals.RightArea">

            <!-- Anzeige-Modus -->
            <ScrollViewer Visibility="{Binding IsDetailsOpen, Converter={StaticResource BoolToVisibility}}"
                          AutomationProperties.AutomationId="Animals.DetailsArea">
                <StackPanel>
                    <Border Style="{StaticResource Card}" AutomationProperties.AutomationId="Animals.DetailsCard">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                <TextBlock Text="{Binding SelectedAnimalName}"
                                           FontSize="24"
                                           FontWeight="Bold"
                                           AutomationProperties.AutomationId="Animals.Selected.Name"/>
                                <TextBlock Text=" (" FontSize="24" FontWeight="Bold"
                                           Foreground="{StaticResource TextMutedBrush}"/>
                                <TextBlock Text="{Binding SelectedAnimalSpecies}"
                                           FontSize="24"
                                           FontWeight="Bold"
                                           Foreground="{StaticResource TextMutedBrush}"
                                           AutomationProperties.AutomationId="Animals.Selected.Species"/>
                                <TextBlock Text=")" FontSize="24" FontWeight="Bold"
                                           Foreground="{StaticResource TextMutedBrush}"/>
                            </StackPanel>

                            <!-- Stammdaten -->
                            <Grid Margin="0,0,0,16" AutomationProperties.AutomationId="Animals.Selected.DetailsGrid">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Text="Name:" FontWeight="SemiBold" Margin="0,4,12,4"/>
                                <TextBlock Text="{Binding SelectedAnimalName}"
                                           Grid.Column="1"
                                           Margin="0,4,0,4"
                                           AutomationProperties.AutomationId="Animals.Selected.NameDetail"/>

                                <TextBlock Text="Gehege:" Grid.Row="1" FontWeight="SemiBold" Margin="0,4,12,4"/>
                                <TextBlock Text="{Binding SelectedAnimalEnclosure}"
                                           Grid.Row="1"
                                           Grid.Column="1"
                                           Margin="0,4,0,4"
                                           AutomationProperties.AutomationId="Animals.Selected.Enclosure"/>

                                <TextBlock Text="Nächste Fütterung:" Grid.Row="2" FontWeight="SemiBold" Margin="0,4,12,4"/>
                                <TextBlock Text="{Binding SelectedAnimalFeeding}"
                                           Grid.Row="2"
                                           Grid.Column="1"
                                           Margin="0,4,0,4"
                                           Foreground="{StaticResource AccentBrush}"
                                           FontWeight="Bold"
                                           AutomationProperties.AutomationId="Animals.Selected.Feeding"/>

                                <ItemsControl Grid.Row="3"
                                              Grid.ColumnSpan="2"
                                              Margin="0,10,0,0"
                                              ItemsSource="{Binding DynamicAttributes}"
                                              AutomationProperties.AutomationId="Animals.DynamicAttributesList">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Grid Margin="0,4">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="{Binding Key, StringFormat='\{0\}:'}"
                                                           FontWeight="SemiBold"
                                                           Margin="0,0,12,0"/>
                                                <TextBlock Text="{Binding Value}" Grid.Column="1"/>
                                            </Grid>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </Grid>

                            <Separator Margin="0,20"/>

                            <TextBlock Text="Chronologie / Ereignisse"
                                       FontSize="16"
                                       FontWeight="SemiBold"
                                       Margin="0,0,0,12"
                                       AutomationProperties.AutomationId="Animals.Events.Title"/>

                            <ItemsControl ItemsSource="{Binding Events}"
                                          AutomationProperties.AutomationId="Animals.EventsList">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border BorderBrush="#EEE" BorderThickness="0,0,0,1" Padding="0,8">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="120"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Text="{Binding Date, StringFormat=d}"
                                                           Foreground="{StaticResource TextMutedBrush}"/>

                                                <StackPanel Grid.Column="1">
                                                    <TextBlock Text="{Binding Type}" FontWeight="Bold"/>
                                                    <TextBlock Text="{Binding Description}" TextWrapping="Wrap"/>
                                                </StackPanel>

                                                <StackPanel Grid.Column="2"
                                                            Orientation="Horizontal"
                                                            VerticalAlignment="Top"
                                                            Margin="12,0,0,0"
                                                            Visibility="{Binding DataContext.CanManageEvents, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BoolToVisibility}}">
                                                    <Button Padding="8,6"
                                                            Margin="0,0,8,0"
                                                            Command="{Binding DataContext.EditEventCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                            CommandParameter="{Binding}"
                                                            ToolTip="Bearbeiten"
                                                            AutomationProperties.AutomationId="Animals.Event.EditBtn">
                                                        <TextBlock FontFamily="Segoe MDL2 Assets"
                                                                   FontSize="16"
                                                                   Text="&#xE70F;" />
                                                    </Button>

                                                    <Button Padding="8,6"
                                                            Background="#FFEBEE"
                                                            Foreground="#D32F2F"
                                                            BorderBrush="#FFCDD2"
                                                            Command="{Binding DataContext.DeleteEventCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                            CommandParameter="{Binding}"
                                                            ToolTip="Löschen"
                                                            AutomationProperties.AutomationId="Animals.Event.DeleteBtn">
                                                        <TextBlock FontFamily="Segoe MDL2 Assets"
                                                                   FontSize="16"
                                                                   Text="&#xE74D;" />
                                                    </Button>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <Border Background="#F9F9F9"
                                    CornerRadius="8"
                                    Padding="16"
                                    Margin="0,16,0,0"
                                    BorderBrush="#EEE"
                                    BorderThickness="1"
                                    AutomationProperties.AutomationId="Animals.NewEventCard">
                                <StackPanel>
                                    <TextBlock Text="{Binding EventEditorTitle}"
                                               FontWeight="Bold"
                                               Margin="0,0,0,12"
                                               Foreground="{StaticResource PrimaryBrush}"/>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="1*"/>
                                            <ColumnDefinition Width="1.5*"/>
                                            <ColumnDefinition Width="1*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <Label Content="Datum:" Grid.Row="0" Grid.Column="0" FontSize="11"
                                               Foreground="{StaticResource TextMutedBrush}"/>
                                        <Label Content="Ereignis-Typ:" Grid.Row="0" Grid.Column="1" FontSize="11"
                                               Foreground="{StaticResource TextMutedBrush}"/>
                                        <Label Content="Beschreibung:" Grid.Row="0" Grid.Column="2" FontSize="11"
                                               Foreground="{StaticResource TextMutedBrush}"/>

                                        <DatePicker Grid.Row="1"
                                                    Grid.Column="0"
                                                    Margin="0,0,8,0"
                                                    VerticalAlignment="Center"
                                                    SelectedDate="{Binding NewEventDate}"
                                                    AutomationProperties.AutomationId="Animals.NewEvent.Date"/>
                                        <TextBox Grid.Row="1"
                                                 Grid.Column="1"
                                                 Margin="0,0,8,0"
                                                 Padding="5"
                                                 VerticalAlignment="Center"
                                                 Text="{Binding NewEventType, UpdateSourceTrigger=PropertyChanged}"
                                                 ToolTip="z.B. Tierarzt, Transport, Fütterung"
                                                 AutomationProperties.AutomationId="Animals.NewEvent.Type"/>
                                        <TextBox Grid.Row="1"
                                                 Grid.Column="2"
                                                 Padding="5"
                                                 VerticalAlignment="Center"
                                                 Text="{Binding NewEventDesc, UpdateSourceTrigger=PropertyChanged}"
                                                 ToolTip="Details zum Ereignis"
                                                 AutomationProperties.AutomationId="Animals.NewEvent.Description"/>
                                    </Grid>

                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
                                        <Button Content="Abbrechen"
                                                Margin="0,0,12,0"
                                                Padding="14,8"
                                                Visibility="{Binding IsCancelEditEventVisible, Converter={StaticResource BoolToVisibility}}"
                                                Command="{Binding CancelEditEventCommand}"
                                                AutomationProperties.AutomationId="Animals.NewEvent.CancelEditBtn"/>

                                        <Button Content="{Binding SaveEventButtonText}"
                                                Padding="20,8"
                                                Background="{StaticResource PrimaryBrush}"
                                                Foreground="White"
                                                FontWeight="SemiBold"
                                                Command="{Binding AddOrUpdateEventCommand}"
                                                AutomationProperties.AutomationId="Animals.NewEvent.SaveBtn"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>

            <!-- ANLEGE-MODUS (Editor) -->
            <Border Style="{StaticResource Card}"
                    Visibility="{Binding IsEditorOpen, Converter={StaticResource BoolToVisibility}}"
                    VerticalAlignment="Top"
                    AutomationProperties.AutomationId="Animals.EditorArea">
                <StackPanel>
                    <TextBlock Text="Neues Tier anlegen"
                               FontSize="22"
                               FontWeight="Bold"
                               Margin="0,0,0,20"
                               AutomationProperties.AutomationId="Animals.Editor.Title"/>

                    <Label Content="Name des Tieres:"/>
                    <TextBox Margin="0,0,0,12"
                             Padding="8"
                             Text="{Binding NewAnimalName, UpdateSourceTrigger=PropertyChanged}"
                             AutomationProperties.AutomationId="Animals.Editor.NewAnimalName"/>

                    <Label Content="Tierart:"/>
                    <ComboBox DisplayMemberPath="Name"
                              Margin="0,0,0,12"
                              Padding="8"
                              ItemsSource="{Binding SpeciesOptions}"
                              SelectedItem="{Binding SelectedSpecies}"
                              AutomationProperties.AutomationId="Animals.Editor.SpeciesSelector"/>

                    <Label Content="Gehege:"/>
                    <ComboBox DisplayMemberPath="Name"
                              Margin="0,0,0,12"
                              Padding="8"
                              ItemsSource="{Binding EnclosureOptions}"
                              SelectedItem="{Binding SelectedEnclosure}"
                              AutomationProperties.AutomationId="Animals.Editor.EnclosureSelector"/>

                    <Label Content="Erste Fütterung (Datum &amp; Uhrzeit):"/>
                    <Grid Margin="0,0,0,12" AutomationProperties.AutomationId="Animals.Editor.FeedingGrid">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*"/>
                            <ColumnDefinition Width="1*"/>
                            <ColumnDefinition Width="1*"/>
                        </Grid.ColumnDefinitions>

                        <DatePicker Grid.Column="0"
                                    Margin="0,0,8,0"
                                    Padding="5"
                                    SelectedDate="{Binding NewAnimalFeedingDate}"
                                    AutomationProperties.AutomationId="Animals.Editor.FeedingDate"/>
                        <ComboBox Grid.Column="1"
                                  Margin="0,0,8,0"
                                  Padding="5"
                                  ToolTip="Stunde"
                                  ItemsSource="{Binding FeedingHours}"
                                  SelectedItem="{Binding SelectedFeedingHour}"
                                  AutomationProperties.AutomationId="Animals.Editor.FeedingHour"/>
                        <ComboBox Grid.Column="2"
                                  Padding="5"
                                  ToolTip="Minute"
                                  ItemsSource="{Binding FeedingMinutes}"
                                  SelectedItem="{Binding SelectedFeedingMinute}"
                                  AutomationProperties.AutomationId="Animals.Editor.FeedingMinute"/>
                    </Grid>

                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,0">
                        <Button Content="Abbrechen"
                                Margin="0,0,12,0"
                                Padding="24,8"
                                Command="{Binding CancelEditorCommand}"
                                AutomationProperties.AutomationId="Animals.Editor.CancelBtn"/>
                        <Button Content="Speichern"
                                Padding="24,8"
                                Background="{StaticResource PrimaryBrush}"
                                Foreground="White"
                                Command="{Binding SaveNewAnimalCommand}"
                                AutomationProperties.AutomationId="Animals.Editor.SaveBtn"/>
                    </StackPanel>
                </StackPanel>
            </Border>

        </Grid>
    </Grid>
</UserControl>